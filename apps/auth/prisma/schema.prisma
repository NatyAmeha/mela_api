// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  email              String?  @unique @default(uuid())
  phoneNumber        String?  @unique @default(uuid())
  username           String?  @unique @default(uuid())
  firstName          String?
  lastName           String?
  password           String?
  profileImageUrl    String?
  refreshToken       String?
  accountStatus      String?  @default("PENDING")
  isEmailPlaceholder Boolean? @default(false)
  accesses           Access[]
  accessIds          String[]
  dateCreated        DateTime @default(now())
  dateUpdated        DateTime @default(now())
}

model Access {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  role        String
  resourceId  String?
  permissions Permission[]
  userId      String       @db.ObjectId
  user        User         @relation(fields: [userId], references: [id])
  dateCreated DateTime     @default(now())
  dateUpdated DateTime     @default(now())
}

type Permission {
  id             String            @default(uuid())
  action         String // CRUD, etc
  resourceType   String // bueiness, subscription, product, service etc
  resourceTarget String
  effect         String // ALLOW, DENY,
  userGenerated  Boolean           @default(false)
  groups         PermissionGroup[]
}

type PermissionGroup {
  id   String?    @default(uuid())
  name NameType[]
  key  String?
}

type NameType {
  key   String
  value String
}
